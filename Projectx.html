<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Solo Leveling Data Analyzer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: url('https://images6.alphacoders.com/133/thumb-1920-1337257.jpeg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }
    .container {
      background: rgba(0,0,0,0.85);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px #00f7ff, 0 0 40px #00f7ff;
      width: 560px;
      text-align: center;
      border: 2px solid #00f7ff;
    }
    h2 {
      margin-bottom: 15px;
      color: #00f7ff;
      text-shadow: 0 0 10px #00f7ff, 0 0 20px #00f7ff;
    }
    label {
      font-weight: bold;
      color: #00f7ff;
    }
    input, select, button {
      margin: 8px 0;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #00f7ff;
      background: rgba(0,0,0,0.6);
      color: #00f7ff;
      width: 90%;
      font-weight: bold;
      box-shadow: 0 0 10px #00f7ff inset;
    }
    button {
      background: #00f7ff;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      box-shadow: 0 0 10px #00f7ff, 0 0 20px #00f7ff;
    }
    button:hover {
      background: #0ff;
      color: #111;
      box-shadow: 0 0 20px #00f7ff, 0 0 40px #00f7ff;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      color: #fff;
      font-weight: bold;
    }
    th, td {
      border: 1px solid #00f7ff;
      padding: 8px;
      text-align: center;
    }
    th {
      background: rgba(0, 247, 255, 0.3);
      color: #00f7ff;
      text-shadow: 0 0 10px #00f7ff;
    }
    tr:nth-child(even) {
      background: rgba(255,255,255,0.05);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>⚔️ Data Analyzer ⚔️</h2>

    <label>Upload Excel File:</label>
    <input type="file" id="upload" accept=".xlsx,.xls"><br>

    <label>Select Date:</label>
    <input type="date" id="dateFilter"><br>

    <label>Select Column:</label>
    <select id="columnSelect">
      <option value="Remarks">Remarks</option>
      <option value="Sno">Sno</option>
      <option value="Date">Date</option>
      <option value="Number">Number</option>
      <option value="Time">Time</option>
      <option value="Name">Name</option>
      <option value="Age">Age</option>
      <option value="Problem">Problem</option>
      <option value="Location">Location</option>
    </select><br>

    <button onclick="analyze()">Analyze</button>
    <div id="output"></div>
  </div>

  <script>
    let excelData = [];

    document.getElementById('upload').addEventListener('change', handleFile, false);

    function handleFile(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        excelData = XLSX.utils.sheet_to_json(firstSheet, { defval: "" });
        alert("✅ File loaded successfully!");
      };
      reader.readAsArrayBuffer(file);
    }

    function analyze() {
      const dateInput = document.getElementById("dateFilter").value;
      const column = document.getElementById("columnSelect").value;

      if (!dateInput) {
        alert("Please select a date");
        return;
      }

      const chosenDate = new Date(dateInput);
      const formattedDate = 
        String(chosenDate.getDate()).padStart(2,'0') + "-" +
        String(chosenDate.getMonth()+1).padStart(2,'0') + "-" +
        chosenDate.getFullYear();

      let counts = {};
      let total = 0;

      excelData.forEach(row => {
        let rowDate = row["Date"];
        if (!rowDate) return;

        if (rowDate instanceof Date) {
          rowDate = 
            String(rowDate.getDate()).padStart(2,'0') + "-" +
            String(rowDate.getMonth()+1).padStart(2,'0') + "-" +
            rowDate.getFullYear();
        }

        if (rowDate == formattedDate) {
          if (row[column]) {
            const value = row[column].toString().trim().toLowerCase();
            if (value) {
              counts[value] = (counts[value] || 0) + 1;
              total++;
            }
          }
        }
      });

      let output = "<table><tr><th>" + column + "</th><th>Count</th></tr>";
      Object.entries(counts)
        .sort((a,b) => b[1]-a[1])
        .forEach(([v,c]) => {
          output += `<tr><td>${v}</td><td>${c}</td></tr>`;
        });
      output += `<tr><th>Total</th><th>${total}</th></tr></table>`;

      document.getElementById("output").innerHTML = output;
    }
  </script>
</body>
</html>